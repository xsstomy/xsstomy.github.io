<!DOCTYPE html><html lang="null"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><title>使用TypeScript编写React - 卖苹果的</title><meta name="description" content="缘由最近在业余学习React，本身接触的egret一年多了，接触TypeScript时间还算有段时间，非常喜欢TypeScript。学习了TypeScript 就再也不想写JavaScript了。看了找了好些教程都是直接用JavaScript来写React,比较痛苦。今天找到了一篇比较好的教程。于是"><link type="text/css" rel="stylesheet" href="/css/basic.css?v=0.0.0"><link type="text/css" rel="stylesheet" href="/css/pure.css?v=0.0.0"><link type="text/css" rel="stylesheet" href="/css/style.css?v=0.0.0"><script type="text/javascript" src="//cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script></head></html><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">使用TypeScript编写React</h1><a id="logo" href="/.">卖苹果的</a></div><div id="nav-menu"><div class="bitcron_nav"><div class="site_nav_wrap"><div class="site_nav"><span class="a_container"><a href="/." class="selected active current">首页</a></span><span class="a_container"><a href="/archives/">归档</a></span><span class="a_container"><a href="/about/">关于</a></span><span class="a_container"><a href="/booklist/">书单</a></span><span class="a_container"><a href="/think/">思考与习惯</a></span></div></div></div></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">使用TypeScript编写React</h1><div class="post-meta">Dec 17, 2015<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" type="text/javascript"></script><span class="meta-space">  |  </span><span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span><span> 浏览</span></span></div><div class="post-content"><h2 id="缘由"><a href="#缘由" class="headerlink" title="缘由"></a>缘由</h2><p>最近在业余学习React，本身接触的egret一年多了，接触TypeScript时间还算有段时间，非常喜欢TypeScript。学习了TypeScript 就再也不想写JavaScript了。看了找了好些教程都是直接用JavaScript来写React,比较痛苦。今天找到了一篇比较好的教程。于是就想翻译一下，这里是<a href="http://blog.wolksoftware.com/working-with-react-and-typescript" target="_blank" rel="external">原始博客链接</a>，于是就有了这篇博客。</p>
<p>简单的介绍使用TypeScript 和 Atom 来开发 React 应用。</p>
<p>我们准备从 TodoMVC 项目开始，使用React 和 TypeScript 来开发著名的TODO App.<br><img src="/uploads/2015/12/17/9/7yjwysnxnekg_retina.png" alt=""></p>
<p>在这篇文章中你将学习到如下内容：</p>
<ul>
<li>1.搭建开发环境</li>
<li>2.设置项目</li>
<li>3.React 基础组件</li>
<li>4.使用TypeScript 开发 React组件</li>
<li>5.编译应用</li>
<li>6.运行应用</li>
</ul>
<h2 id="搭建开发环境"><a href="#搭建开发环境" class="headerlink" title="搭建开发环境"></a>搭建开发环境</h2><p>我们将开始搭建开发环境</p>
<ul>
<li>下载并安装node.js <a href="https://nodejs.org/en/" target="_blank" rel="external">https://nodejs.org/en/</a></li>
<li>使用npm 安装 TypeScript</li>
</ul>
<p><code>$ npm install -g typescript tsd</code></p>
<blockquote>
<p>说明:如果你使用的是OSX系统，请在命令行前面加上 sudo</p>
</blockquote>
<ul>
<li>下载并安装 Atom <a href="https://atom.io/" target="_blank" rel="external">https://atom.io/</a></li>
</ul>
<p><img src="/uploads/2015/12/17/9/poybtywe40rjbq_retina.png" alt=""></p>
<ul>
<li>为Atom安装 atom-typescript插件</li>
</ul>
<p><code>$ apm install atom-typescript</code></p>
<p>这个插件有一些很酷的功能，如HTML 转换成 TSX：</p>
<p><img src="/uploads/2015/12/17/9/livogugozhshlq_retina.gif" alt=""></p>
<p>或依赖视图：</p>
<p><img src="/uploads/2015/12/17/9/bontsmxoxxadda_retina.png" alt=""></p>
<p>如果你感兴趣，请到<a href="https://github.com/TypeStrong/atom-typescript" target="_blank" rel="external">project’s page on Github</a>查看该插件更多的功能。</p>
<ul>
<li>安装<a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?hl=en" target="_blank" rel="external">React的谷歌开发插件</a></li>
</ul>
<p>这个插件方便我们调试React应用 可以查看属性值和所选组件的状态。</p>
<p><img src="/uploads/2015/12/17/9/td99h20vs5yzq_retina.png" alt=""></p>
<h2 id="设置项目"><a href="#设置项目" class="headerlink" title="设置项目"></a>设置项目</h2><p>到本教程结束时，该项目的结构类似下面的一个：</p>
<p><img src="/uploads/2015/12/17/9/1.png" alt=""></p>
<p>让我们从创建应用的根目录开始</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ mkdir typescript-react</div><div class="line">$ cd typescript-react</div></pre></td></tr></table></figure>
<p>然后在项目的根目录里面创建 <code>package.json</code> 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	private: true,</div><div class="line">  	dependencies: &#123;</div><div class="line">    director: &quot;^1.2.0&quot;,</div><div class="line">    react: &quot;^0.13.3&quot;,</div><div class="line">    todomvc-app-css: &quot;^2.0.0&quot;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>再然后你可以使用npm来安装项目所依赖的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 在项目的根目录文件</div><div class="line">$ npm install</div></pre></td></tr></table></figure>
<p>这个命令会在项目的根目录生成一个<code>node_modules</code>文件夹，在<code>node_modules</code>文件夹下会包含有三个文件，分别是<code>director</code>,<code>react</code>和<code>todomvc-app-css</code>。</p>
<p>我们现在开始安装一些TypeScript类型定义文件</p>
<p>类型定义文件通常用于定义公用的第三方库文件API接口，比如React。在一些IDE中使用TypeScript开发应用，IDE可以通过这些接口提供一些代码提示，方便项目的开发。</p>
<p>类型定义文件也用于编译器来确保我们正确地使用第三方库。</p>
<p>我们现在需要React 的类型定义文件，我们可以通过下面的命令来创建他们。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">//在应用的根目录</div><div class="line">$ tsd init</div><div class="line">$ tsd install react --save</div></pre></td></tr></table></figure>
<p>以上命令会在应用的根目录创建一个    <code>tsd.json</code>文件和 <code>typings</code>文件夹，在<code>typings</code>文件夹中包含<code>react</code>文件夹</p>
<p>我们也需要<a href="https://raw.githubusercontent.com/borisyankov/DefinitelyTyped/master/react/react-global.d.ts" target="_blank" rel="external">下载</a>然后取名为<code>global.d.ts</code>保存到<code>typings/react</code>文件夹下。</p>
<p><img src="/uploads/2015/12/17/9/2.png" alt=""></p>
<p>我们现在到应用根目录创建<code>index.html</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">&lt;!doctype html&gt;</div><div class="line">&lt;html lang=&quot;en&quot; data-framework=&quot;typescript&quot;&gt;</div><div class="line">  &lt;head&gt;</div><div class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</div><div class="line">    &lt;title&gt;React • TodoMVC&lt;/title&gt;</div><div class="line">    &lt;link rel=&quot;stylesheet&quot; </div><div class="line">          href=&quot;node_modules/todomvc-common/base.css&quot;&gt;</div><div class="line">    &lt;link rel=&quot;stylesheet&quot; </div><div class="line">          href=&quot;node_modules/todomvc-app-css/index.css&quot;&gt;</div><div class="line">  &lt;/head&gt;</div><div class="line">  &lt;body&gt;</div><div class="line">    &lt;section class=&quot;todoapp&quot;&gt;&lt;/section&gt;</div><div class="line">    &lt;footer class=&quot;info&quot;&gt;</div><div class="line">      &lt;p&gt;Double-click to edit a todo&lt;/p&gt;</div><div class="line">      &lt;p&gt;</div><div class="line">        Created by </div><div class="line">        &lt;a href=&quot;http://github.com/remojansen/&quot;&gt;Remo H. Jansen&lt;/a&gt;</div><div class="line">      &lt;/p&gt;</div><div class="line">      &lt;p&gt;Part of &lt;a href=&quot;http://todomvc.com&quot;&gt;TodoMVC&lt;/a&gt;&lt;/p&gt;</div><div class="line">    &lt;/footer&gt;</div><div class="line">    &lt;script type=&quot;text/javascript&quot; </div><div class="line">            src=&quot;node_modules/react/dist/react-with-addons.js&quot;&gt;</div><div class="line">    &lt;/script&gt;</div><div class="line">    &lt;script type=&quot;text/javascript&quot; </div><div class="line">            src=&quot;node_modules/director/build/director.js&quot;&gt;</div><div class="line">    &lt;/script&gt;</div><div class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;js/constants.js&quot;&gt;&lt;/script&gt;</div><div class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;js/utils.js&quot;&gt;&lt;/script&gt;</div><div class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;js/todoModel.js&quot;&gt;&lt;/script&gt;</div><div class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;js/todoItem.js&quot;&gt;&lt;/script&gt;</div><div class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;js/footer.js&quot;&gt;&lt;/script&gt;</div><div class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;js/app.js&quot;&gt;&lt;/script&gt;</div><div class="line">  &lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<p>此时，你的应用目录结构应该是这样的</p>
<p><img src="/uploads/2015/12/17/9/3.png" alt=""></p>
<p>你可能注意到在<code>index.html</code>文件中有些JavaScript文件是缺少的，我们接下来将解决这个问题。</p>
<h2 id="React-基础组件"><a href="#React-基础组件" class="headerlink" title="React 基础组件"></a>React 基础组件</h2><p>组件是React的主要应用程序块，一个组件表示一个自包含的用户界面，组件通常会显示一些数据，并且能够处理一些用户交互。</p>
<p>组件可以包含子组件。我们即将开发的应用程序是非常小的，所以我们只会开发一个顶级组件取名TodoApp。</p>
<p>TodoApp 组件将有多个组件组成，包含一个TodoFooter组件和一些TodoItem组件。</p>
<p><img src="/uploads/2015/12/17/9/plmlol7n2cfq_retina.png" alt=""></p>
<p>组件区分不同的数据集：<strong>属性和状态</strong>。</p>
<h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><blockquote>
<p>属性（短的属性）是一个组件的配置，它的选项，如果你可以。它们是从上面接收到的，并且是不可改变的，因为接收它们的组件是有关的。</p>
<p>组件不能更改其属性，但它负责将其子组件的属性放在一起。</p>
</blockquote>
<h4 id="状态"><a href="#状态" class="headerlink" title="状态"></a>状态</h4><blockquote>
<p>该状态从一个组件安装时开始，并在时间（主要是用户事件产生的情况下）遭受突变。这是一个序列化表示在时间快照一点</p>
<p>组件管理其自己的内部，除了设置初始状态与它的孩子的状态不改。你可以说内部是私有的。</p>
</blockquote>
<p>当我们使用TypeScript定义一个新的React组件的时候，我们必须申明接口的属性和状态，如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class SomeComponent extends React.Component&lt;ISomeComponentProps, ISomeComponentState&gt; &#123;</div><div class="line">  // ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在，我们有我们的项目结构的地方，我们知道的基本知识，现在开始开发我们的组件。</p>
<h2 id="使用TypeScript-开发-React组件"><a href="#使用TypeScript-开发-React组件" class="headerlink" title="使用TypeScript 开发 React组件"></a>使用TypeScript 开发 React组件</h2><p>我们在应用根目录下创建一个名为js的文件夹，然后我们将创建如下图的目录结构文件</p>
<p><img src="/uploads/2015/12/17/9/4.png" alt=""></p>
<p>当我们创建完成之后，我们可以随意的修改它们。</p>
<h4 id="interfaces-d-ts"><a href="#interfaces-d-ts" class="headerlink" title="interfaces.d.ts"></a>interfaces.d.ts</h4><p>我们将把我们应用中的所有接口都定义在此文件中。我们使用的扩展。d.ts（这也是由类型定义文件使用）代替。TS因为这个文件不会编译成为JavaScript文件。在我们编程过程中，此文件不会被编译，因为TypeScript接口不会编译成JavaScript。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">// Defines the interface of the structure of a task</div><div class="line">interface ITodo &#123;</div><div class="line">  id: string,</div><div class="line">  title: string,</div><div class="line">  completed: boolean</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">// Defines the interface of the properties of the TodoItem component</div><div class="line">interface ITodoItemProps &#123;</div><div class="line">  key : string,</div><div class="line">  todo : ITodo;</div><div class="line">  editing? : boolean;</div><div class="line">  onSave: (val: any) =&gt; void;</div><div class="line">  onDestroy: () =&gt; void;</div><div class="line">  onEdit: ()  =&gt; void;</div><div class="line">  onCancel: (event : any) =&gt; void;</div><div class="line">  onToggle: () =&gt; void;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">// Defines the interface of the state of the TodoItem component</div><div class="line">interface ITodoItemState &#123;</div><div class="line">  editText : string</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">// Defines the interface of the properties of the Footer component</div><div class="line">interface ITodoFooterProps &#123;</div><div class="line">  completedCount : number;</div><div class="line">  onClearCompleted : any;</div><div class="line">  nowShowing : string;</div><div class="line">  count : number;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// Defines the TodoModel interface</div><div class="line">interface ITodoModel &#123;</div><div class="line">  key : any;</div><div class="line">  todos : Array&lt;ITodo&gt;;</div><div class="line">  onChanges : Array&lt;any&gt;;</div><div class="line">  subscribe(onChange);</div><div class="line">  inform();</div><div class="line">  addTodo(title : string);</div><div class="line">  toggleAll(checked);</div><div class="line">  toggle(todoToToggle);</div><div class="line">  destroy(todo);</div><div class="line">  save(todoToSave, text);</div><div class="line">  clearCompleted();</div><div class="line">&#125;</div><div class="line"></div><div class="line">// Defines the interface of the properties of the App component</div><div class="line">interface IAppProps &#123;</div><div class="line">  model : ITodoModel;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// Defines the interface of the state of the App component</div><div class="line">interface IAppState &#123;</div><div class="line">  editing? : string;</div><div class="line">  nowShowing? : string</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h4><p>这个文件用于定义一些常量。通常用于保存一些键盘的常量和一些事件。</p>
<p>我们也可以用一些值来区分一些任务的当前状态:</p>
<ul>
<li>COMPLETED_TODOS 用于完成任务时</li>
<li>ACTIVE_TODOS 用于没有完成任务时</li>
<li>ALL_TODOS 用于显示所有任务时使用</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">namespace app.constants &#123;</div><div class="line">  export var ALL_TODOS = &apos;all&apos;;</div><div class="line">  export var ACTIVE_TODOS = &apos;active&apos;;</div><div class="line">  export var COMPLETED_TODOS = &apos;completed&apos;;</div><div class="line">  export var ENTER_KEY = 13;</div><div class="line">  export var ESCAPE_KEY = 27;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="实用工具"><a href="#实用工具" class="headerlink" title="实用工具"></a>实用工具</h4><p>这个文件包含一个叫<code>Utils</code>的类。这个类不仅仅包含是一些静态方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">namespace app.miscelanious &#123;</div><div class="line"></div><div class="line">  export class Utils &#123;</div><div class="line"></div><div class="line">    // generates a new Universally unique identify (UUID) </div><div class="line">    // the UUID is used to identify each of the tasks</div><div class="line">    public static uuid() : string &#123;</div><div class="line">      /*jshint bitwise:false */</div><div class="line">      var i, random;</div><div class="line">      var uuid = &apos;&apos;;</div><div class="line"></div><div class="line">      for (i = 0; i &lt; 32; i++) &#123;</div><div class="line">        random = Math.random() * 16 | 0;</div><div class="line">        if (i === 8 || i === 12 || i === 16 || i === 20) &#123;</div><div class="line">          uuid += &apos;-&apos;;</div><div class="line">        &#125;</div><div class="line">        uuid += (i === 12 ? 4 : (i === 16 ? (random &amp; 3 | 8) : random))</div><div class="line">          .toString(16);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      return uuid;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // adds &apos;s&apos; to the end of a given world when count &gt; 1</div><div class="line">    public static pluralize(count, word) &#123;</div><div class="line">      return count === 1 ? word : word + &apos;s&apos;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // stores data using the localStorage API</div><div class="line">    public static store(namespace, data?) &#123;</div><div class="line">      if (data) &#123;</div><div class="line">        return localStorage.setItem(namespace, JSON.stringify(data));</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      var store = localStorage.getItem(namespace);</div><div class="line">      return (store &amp;&amp; JSON.parse(store)) || [];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // just a helper for inheritance</div><div class="line">    public static extend(...objs : any[]) : any &#123;</div><div class="line">      var newObj = &#123;&#125;;</div><div class="line">      for (var i = 0; i &lt; objs.length; i++) &#123;</div><div class="line">        var obj = objs[i];</div><div class="line">        for (var key in obj) &#123;</div><div class="line">          if (obj.hasOwnProperty(key)) &#123;</div><div class="line">            newObj[key] = obj[key];</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">      return newObj;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h4><p>TodoModel 是一个通用 “model” 对象。由于这个应用程序是非常小的，它甚至可能不值得把这个逻辑分开，但我们这样做是为了演示一种方式来分离你的应用程序的部分。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div></pre></td><td class="code"><pre><div class="line">/// &lt;reference path=&quot;../typings/react/react-global.d.ts&quot; /&gt;</div><div class="line">/// &lt;reference path=&quot;./interfaces.d.ts&quot;/&gt;</div><div class="line"></div><div class="line">namespace app.models &#123;</div><div class="line"></div><div class="line">  export class TodoModel implements ITodoModel &#123;</div><div class="line"></div><div class="line">    public key : string;            // key used for local storage</div><div class="line">    public todos : Array&lt;ITodo&gt;;    // a list of tasks</div><div class="line">    public onChanges : Array&lt;any&gt;;  // a list of events</div><div class="line"></div><div class="line">    constructor(key) &#123;</div><div class="line">      this.key = key;</div><div class="line">      this.todos = app.miscelanious.Utils.store(key);</div><div class="line">      this.onChanges = [];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // the following are some methods </div><div class="line">    // used to manipulate the list of tasks</div><div class="line"></div><div class="line">    public subscribe(onChange) &#123;</div><div class="line">      this.onChanges.push(onChange);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public inform() &#123;</div><div class="line">      app.miscelanious.Utils.store(this.key, this.todos);</div><div class="line">      this.onChanges.forEach(function (cb) &#123; cb(); &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public addTodo(title : string) &#123;</div><div class="line">      this.todos = this.todos.concat(&#123;</div><div class="line">        id: app.miscelanious.Utils.uuid(),</div><div class="line">        title: title,</div><div class="line">        completed: false</div><div class="line">      &#125;);</div><div class="line"></div><div class="line">      this.inform();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public toggleAll(checked) &#123;</div><div class="line">      // Note: it&apos;s usually better to use immutable </div><div class="line">      // data structures since they&apos;re easier to </div><div class="line">      // reason about and React works very </div><div class="line">      // well with them. That&apos;s why we use </div><div class="line">      // map() and filter() everywhere instead of </div><div class="line">      // mutating the array or todo items themselves.</div><div class="line">      this.todos = this.todos.map&lt;ITodo&gt;((todo : ITodo) =&gt; &#123;</div><div class="line">        return app.miscelanious.Utils.extend(</div><div class="line">          &#123;&#125;, todo, &#123;completed: checked&#125;</div><div class="line">        );</div><div class="line">      &#125;);</div><div class="line"></div><div class="line">      this.inform();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public toggle(todoToToggle) &#123;</div><div class="line">      this.todos = this.todos.map&lt;ITodo&gt;((todo : ITodo) =&gt; &#123;</div><div class="line">        return todo !== todoToToggle ?</div><div class="line">          todo :</div><div class="line">          app.miscelanious.Utils.extend(</div><div class="line">            &#123;&#125;, todo, &#123;completed: !todo.completed&#125;</div><div class="line">          );</div><div class="line">      &#125;);</div><div class="line"></div><div class="line">      this.inform();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public destroy(todo) &#123;</div><div class="line">      this.todos = this.todos.filter(function (candidate) &#123;</div><div class="line">        return candidate !== todo;</div><div class="line">      &#125;);</div><div class="line"></div><div class="line">      this.inform();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public save(todoToSave, text) &#123;</div><div class="line">      this.todos = this.todos.map(function (todo) &#123;</div><div class="line">        return todo !== todoToSave ? todo : app.miscelanious.Utils.extend(&#123;&#125;, todo, &#123;title: text&#125;);</div><div class="line">      &#125;);</div><div class="line"></div><div class="line">      this.inform();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public clearCompleted() &#123;</div><div class="line">      this.todos = this.todos.filter(function (todo) &#123;</div><div class="line">        return !todo.completed;</div><div class="line">      &#125;);</div><div class="line"></div><div class="line">      this.inform();</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="页脚"><a href="#页脚" class="headerlink" title="页脚"></a>页脚</h4><p>这个文件使用<code>.tsx</code>扩展代替<code>.ts</code>,因为它包含一些TSX 代码。</p>
<p>TSX 是 JSX的一种超集。我们将使用TSX代替客户端HTML模板因为TSX和JSX是用来生成一个在DOM状态存储。当组件的属性或者状态发生变化时，React会从最有效率的方式去更新DOM状态存储，并且同时把这些改变及时应用于DOM的真实展现。这个过程React非常高效的及时更新DOM内容。</p>
<blockquote>
<p>说明：我们需要一些额外的编译选项来编译<code>.tsx</code>文件。我们将在这篇文章结尾介绍更多关于这方面的内容</p>
</blockquote>
<p>这个页脚组件允许用户去根据状态去删选任务列表和显示一些任务数。这个组件没有状态(注意如何通过将其传递给该接口的状态)但是有一些继承于父亲组件(TodoApp组件)的属性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">/// &lt;reference path=&quot;../typings/react/react-global.d.ts&quot; /&gt;</div><div class="line">/// &lt;reference path=&quot;./interfaces.d.ts&quot;/&gt;</div><div class="line"></div><div class="line">namespace app.components &#123;</div><div class="line"></div><div class="line">  export class TodoFooter extends React.Component&lt;ITodoFooterProps, &#123;&#125;&gt; &#123;</div><div class="line"></div><div class="line">    public render() &#123;</div><div class="line">      var activeTodoWord = app.miscelanious.Utils.pluralize(this.props.count, &apos;item&apos;);</div><div class="line">      var clearButton = null;</div><div class="line"></div><div class="line">      if (this.props.completedCount &gt; 0) &#123;</div><div class="line">        clearButton = (</div><div class="line">          &lt;button</div><div class="line">            className=&quot;clear-completed&quot;</div><div class="line">            onClick=&#123;this.props.onClearCompleted&#125;&gt;</div><div class="line">            Clear completed</div><div class="line">          &lt;/button&gt;</div><div class="line">        );</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      // React idiom for shortcutting to `classSet` since it&apos;ll be used often</div><div class="line">      var cx = React.addons.classSet;</div><div class="line">      var nowShowing = this.props.nowShowing;</div><div class="line">      return (</div><div class="line">        &lt;footer className=&quot;footer&quot;&gt;</div><div class="line">          &lt;span className=&quot;todo-count&quot;&gt;</div><div class="line">            &lt;strong&gt;&#123;this.props.count&#125;&lt;/strong&gt; &#123;activeTodoWord&#125; left</div><div class="line">          &lt;/span&gt;</div><div class="line">          &lt;ul className=&quot;filters&quot;&gt;</div><div class="line">            &lt;li&gt;</div><div class="line">              &lt;a</div><div class="line">                href=&quot;#/&quot;</div><div class="line">                className=&#123;cx(&#123;selected: nowShowing === app.constants.ALL_TODOS&#125;)&#125;&gt;</div><div class="line">                  All</div><div class="line">              &lt;/a&gt;</div><div class="line">            &lt;/li&gt;</div><div class="line">            &#123;&apos; &apos;&#125;</div><div class="line">            &lt;li&gt;</div><div class="line">              &lt;a</div><div class="line">                href=&quot;#/active&quot;</div><div class="line">                className=&#123;cx(&#123;selected: nowShowing === app.constants.ACTIVE_TODOS&#125;)&#125;&gt;</div><div class="line">                  Active</div><div class="line">              &lt;/a&gt;</div><div class="line">            &lt;/li&gt;</div><div class="line">            &#123;&apos; &apos;&#125;</div><div class="line">            &lt;li&gt;</div><div class="line">              &lt;a</div><div class="line">                href=&quot;#/completed&quot;</div><div class="line">                className=&#123;cx(&#123;selected: nowShowing === app.constants.COMPLETED_TODOS&#125;)&#125;&gt;</div><div class="line">                  Completed</div><div class="line">              &lt;/a&gt;</div><div class="line">            &lt;/li&gt;</div><div class="line">          &lt;/ul&gt;</div><div class="line">          &#123;clearButton&#125;</div><div class="line">        &lt;/footer&gt;</div><div class="line">      );</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="todoItem"><a href="#todoItem" class="headerlink" title="todoItem"></a>todoItem</h4><p><code>TodoItem</code>组件代表一个任务列表中的一个任务。<br>这个组件不仅有属性(<code>ITodoItemProps</code>)而且还有状态(<code>ITodoItemState</code>)。</p>
<p>这个组件初始化状态是在构造函数里面设置同时属性是通过父亲组件传递过来的构造函数的参数来设置组件的(<code>TodoApp</code>组件)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div></pre></td><td class="code"><pre><div class="line">/// &lt;reference path=&quot;../typings/react/react-global.d.ts&quot; /&gt;</div><div class="line">/// &lt;reference path=&quot;./interfaces.d.ts&quot;/&gt;</div><div class="line"></div><div class="line">namespace app.components &#123;</div><div class="line"></div><div class="line">  export class TodoItem extends React.Component&lt;ITodoItemProps, ITodoItemState&gt; &#123;</div><div class="line"></div><div class="line">    constructor(props : ITodoItemProps)&#123;</div><div class="line">      super(props);</div><div class="line">      // set initial state</div><div class="line">      this.state = &#123; editText: this.props.todo.title &#125;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public handleSubmit(event) &#123;</div><div class="line">      var val = this.state.editText.trim();</div><div class="line">      if (val) &#123;</div><div class="line">        this.props.onSave(val);</div><div class="line">        this.setState(&#123;editText: val&#125;);</div><div class="line">      &#125; else &#123;</div><div class="line">        this.props.onDestroy();</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public handleEdit() &#123;</div><div class="line">      this.props.onEdit();</div><div class="line">      this.setState(&#123;editText: this.props.todo.title&#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public handleKeyDown(event) &#123;</div><div class="line">      if (event.which === app.constants.ESCAPE_KEY) &#123;</div><div class="line">        this.setState(&#123;editText: this.props.todo.title&#125;);</div><div class="line">        this.props.onCancel(event);</div><div class="line">      &#125; else if (event.which === app.constants.ENTER_KEY) &#123;</div><div class="line">        this.handleSubmit(event);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public handleChange(event) &#123;</div><div class="line">      this.setState(&#123;editText: event.target.value&#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // This is a completely optional performance enhancement </div><div class="line">    // that you can implement on any React component. If you </div><div class="line">    // were to delete this method the app would still work </div><div class="line">    // correctly (and still be very performant!), we just use it </div><div class="line">    // as an example of how little code it takes to get an order</div><div class="line">    // of magnitude performance improvement.</div><div class="line">    public shouldComponentUpdate(nextProps, nextState) &#123;</div><div class="line">      return (</div><div class="line">        nextProps.todo !== this.props.todo ||</div><div class="line">        nextProps.editing !== this.props.editing ||</div><div class="line">        nextState.editText !== this.state.editText</div><div class="line">      );</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // Safely manipulate the DOM after updating the state </div><div class="line">    // when invoking this.props.onEdit() in the handleEdit</div><div class="line">    // method above. </div><div class="line">    public componentDidUpdate(prevProps) &#123;</div><div class="line">      if (!prevProps.editing &amp;&amp; this.props.editing) &#123;</div><div class="line">        var node = React.findDOMNode&lt;HTMLInputElement&gt;(this.refs[&quot;editField&quot;]);</div><div class="line">        node.focus();</div><div class="line">        node.setSelectionRange(node.value.length, node.value.length);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public render() &#123;</div><div class="line">      return (</div><div class="line">        &lt;li className=&#123;React.addons.classSet(&#123;</div><div class="line">          completed: this.props.todo.completed,</div><div class="line">          editing: this.props.editing</div><div class="line">        &#125;)&#125;&gt;</div><div class="line">          &lt;div className=&quot;view&quot;&gt;</div><div class="line">            &lt;input</div><div class="line">              className=&quot;toggle&quot;</div><div class="line">              type=&quot;checkbox&quot;</div><div class="line">              checked=&#123;this.props.todo.completed&#125;</div><div class="line">              onChange=&#123;this.props.onToggle&#125;</div><div class="line">            /&gt;</div><div class="line">            &lt;label onDoubleClick=&#123; e =&gt; this.handleEdit() &#125;&gt;</div><div class="line">              &#123;this.props.todo.title&#125;</div><div class="line">            &lt;/label&gt;</div><div class="line">            &lt;button className=&quot;destroy&quot; onClick=&#123;this.props.onDestroy&#125; /&gt;</div><div class="line">          &lt;/div&gt;</div><div class="line">          &lt;input</div><div class="line">            ref=&quot;editField&quot;</div><div class="line">            className=&quot;edit&quot;</div><div class="line">            value=&#123;this.state.editText&#125;</div><div class="line">            onBlur=&#123; e =&gt; this.handleSubmit(e) &#125;</div><div class="line">            onChange=&#123; e =&gt; this.handleChange(e) &#125;</div><div class="line">            onKeyDown=&#123; e =&gt; this.handleKeyDown(e) &#125;</div><div class="line">          /&gt;</div><div class="line">        &lt;/li&gt;</div><div class="line">      );</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="app模块"><a href="#app模块" class="headerlink" title="app模块"></a>app模块</h4><p>此文件包含应用程序的入口点，这是该应用程序只有顶层组件的todoapp组件声明。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div></pre></td><td class="code"><pre><div class="line">/// &lt;reference path=&quot;../typings/react/react-global.d.ts&quot; /&gt;</div><div class="line">/// &lt;reference path=&quot;./interfaces.d.ts&quot;/&gt;</div><div class="line"></div><div class="line">// We should have installed a type declaration file but</div><div class="line">// for the director npm package but it is not available</div><div class="line">// so we will use this declaration to avoid compilation </div><div class="line">// errors for now.</div><div class="line">declare var Router : any;</div><div class="line"></div><div class="line">var TodoModel = app.models.TodoModel;</div><div class="line">var TodoFooter = app.components.TodoFooter;</div><div class="line">var TodoItem = app.components.TodoItem;</div><div class="line"></div><div class="line">namespace app.components &#123;</div><div class="line"></div><div class="line">  export class TodoApp extends React.Component&lt;IAppProps, IAppState&gt; &#123;</div><div class="line"></div><div class="line">    constructor(props : IAppProps) &#123;</div><div class="line">      super(props);</div><div class="line">      this.state = &#123;</div><div class="line">        nowShowing: app.constants.ALL_TODOS,</div><div class="line">        editing: null</div><div class="line">      &#125;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public componentDidMount() &#123;</div><div class="line">      var setState = this.setState;</div><div class="line">      // we will configure the Router here</div><div class="line">      // our router is provided by the</div><div class="line">      // director npm module</div><div class="line">      // the router observes changes in the URL and </div><div class="line">      // triggers some component&apos;s event accordingly </div><div class="line">      var router = Router(&#123;</div><div class="line">        &apos;/&apos;: setState.bind(this, &#123;nowShowing: app.constants.ALL_TODOS&#125;),</div><div class="line">        &apos;/active&apos;: setState.bind(this, &#123;nowShowing: app.constants.ACTIVE_TODOS&#125;),</div><div class="line">        &apos;/completed&apos;: setState.bind(this, &#123;nowShowing: app.constants.COMPLETED_TODOS&#125;)</div><div class="line">      &#125;);</div><div class="line">      router.init(&apos;/&apos;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public handleNewTodoKeyDown(event) &#123;</div><div class="line">      if (event.keyCode !== app.constants.ENTER_KEY) &#123;</div><div class="line">        return;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      event.preventDefault();</div><div class="line"></div><div class="line">      var val = React.findDOMNode&lt;HTMLInputElement&gt;(this.refs[&quot;newField&quot;]).value.trim();</div><div class="line"></div><div class="line">      if (val) &#123;</div><div class="line">        this.props.model.addTodo(val);</div><div class="line">        React.findDOMNode&lt;HTMLInputElement&gt;(this.refs[&quot;newField&quot;]).value = &apos;&apos;;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public toggleAll(event) &#123;</div><div class="line">      var checked = event.target.checked;</div><div class="line">      this.props.model.toggleAll(checked);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public toggle(todoToToggle) &#123;</div><div class="line">      this.props.model.toggle(todoToToggle);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public destroy(todo) &#123;</div><div class="line">      this.props.model.destroy(todo);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public edit(todo) &#123;</div><div class="line">      this.setState(&#123;editing: todo.id&#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public save(todoToSave, text) &#123;</div><div class="line">      this.props.model.save(todoToSave, text);</div><div class="line">      this.setState(&#123;editing: null&#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public cancel() &#123;</div><div class="line">      this.setState(&#123;editing: null&#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public clearCompleted() &#123;</div><div class="line">      this.props.model.clearCompleted();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // the JSX syntax is quite intuitive but check out</div><div class="line">    // https://facebook.github.io/react/docs/jsx-in-depth.html</div><div class="line">    // if you need additional help</div><div class="line">    public render() &#123;</div><div class="line">      var footer;</div><div class="line">      var main;</div><div class="line">      var todos = this.props.model.todos;</div><div class="line"></div><div class="line">      var shownTodos = todos.filter(function (todo) &#123;</div><div class="line">        switch (this.state.nowShowing) &#123;</div><div class="line">        case app.constants.ACTIVE_TODOS:</div><div class="line">          return !todo.completed;</div><div class="line">        case app.constants.COMPLETED_TODOS:</div><div class="line">          return todo.completed;</div><div class="line">        default:</div><div class="line">          return true;</div><div class="line">        &#125;</div><div class="line">      &#125;, this);</div><div class="line"></div><div class="line">      var todoItems = shownTodos.map(function (todo) &#123;</div><div class="line">        return (</div><div class="line">          &lt;TodoItem</div><div class="line">            key=&#123;todo.id&#125;</div><div class="line">            todo=&#123;todo&#125;</div><div class="line">            onToggle=&#123;this.toggle.bind(this, todo)&#125;</div><div class="line">            onDestroy=&#123;this.destroy.bind(this, todo)&#125;</div><div class="line">            onEdit=&#123;this.edit.bind(this, todo)&#125;</div><div class="line">            editing=&#123;this.state.editing === todo.id&#125;</div><div class="line">            onSave=&#123;this.save.bind(this, todo)&#125;</div><div class="line">            onCancel=&#123; e =&gt; this.cancel() &#125;</div><div class="line">          /&gt;</div><div class="line">        );</div><div class="line">      &#125;, this);</div><div class="line"></div><div class="line">      var activeTodoCount = todos.reduce(function (accum, todo) &#123;</div><div class="line">        return todo.completed ? accum : accum + 1;</div><div class="line">      &#125;, 0);</div><div class="line"></div><div class="line">      var completedCount = todos.length - activeTodoCount;</div><div class="line"></div><div class="line">      if (activeTodoCount || completedCount) &#123;</div><div class="line">        footer =</div><div class="line">          &lt;TodoFooter</div><div class="line">            count=&#123;activeTodoCount&#125;</div><div class="line">            completedCount=&#123;completedCount&#125;</div><div class="line">            nowShowing=&#123;this.state.nowShowing&#125;</div><div class="line">            onClearCompleted=&#123; e=&gt; this.clearCompleted() &#125;</div><div class="line">          /&gt;;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      if (todos.length) &#123;</div><div class="line">        main = (</div><div class="line">          &lt;section className=&quot;main&quot;&gt;</div><div class="line">            &lt;input</div><div class="line">              className=&quot;toggle-all&quot;</div><div class="line">              type=&quot;checkbox&quot;</div><div class="line">              onChange=&#123; e =&gt; this.toggleAll(e) &#125;</div><div class="line">              checked=&#123;activeTodoCount === 0&#125;</div><div class="line">            /&gt;</div><div class="line">            &lt;ul className=&quot;todo-list&quot;&gt;</div><div class="line">              &#123;todoItems&#125;</div><div class="line">            &lt;/ul&gt;</div><div class="line">          &lt;/section&gt;</div><div class="line">        );</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      return (</div><div class="line">        &lt;div&gt;</div><div class="line">          &lt;header className=&quot;header&quot;&gt;</div><div class="line">            &lt;h1&gt;todos&lt;/h1&gt;</div><div class="line">            &lt;input</div><div class="line">              ref=&quot;newField&quot;</div><div class="line">              className=&quot;new-todo&quot;</div><div class="line">              placeholder=&quot;What needs to be done?&quot;</div><div class="line">              onKeyDown=&#123; e =&gt; this.handleNewTodoKeyDown(e) &#125;</div><div class="line">              autoFocus=&#123;true&#125;</div><div class="line">            /&gt;</div><div class="line">          &lt;/header&gt;</div><div class="line">          &#123;main&#125;</div><div class="line">          &#123;footer&#125;</div><div class="line">        &lt;/div&gt;</div><div class="line">      );</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">var model = new TodoModel(&apos;react-todos&apos;);</div><div class="line">var TodoApp = app.components.TodoApp;</div><div class="line"></div><div class="line">function render() &#123;</div><div class="line">  React.render(</div><div class="line">    &lt;TodoApp model=&#123;model&#125;/&gt;,</div><div class="line">    document.getElementsByClassName(&apos;todoapp&apos;)[0]</div><div class="line">  );</div><div class="line">&#125;</div><div class="line"></div><div class="line">model.subscribe(render);</div><div class="line">render();</div></pre></td></tr></table></figure>
<p>确保其中的 <code>this</code>在所有的时候都指向正确的元素。例如，你应用使用箭头函数：<br><code>onKeyDown = { e =&gt; this.handleNewTodoKeyDown(e) }</code><br>代替<br><code>onKeyDown = { this.handleNewTodoKeyDown }</code></p>
<p>确保<code>this</code>指向<code>handleNewTodoKeyDown</code>函数内部的组件。</p>
<h2 id="编译应用程序"><a href="#编译应用程序" class="headerlink" title="编译应用程序"></a>编译应用程序</h2><p>为了编译我们的应用程序，我们需要在<code>js</code>文件夹下添加一个<code>tsconfig.json</code>文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;compilerOptions&quot;: &#123;</div><div class="line">        &quot;target&quot;: &quot;es5&quot;,</div><div class="line">        &quot;module&quot;: &quot;commonjs&quot;,</div><div class="line">        &quot;moduleResolution&quot;: &quot;node&quot;,</div><div class="line">        &quot;isolatedModules&quot;: false,</div><div class="line">        &quot;jsx&quot;: &quot;react&quot;,</div><div class="line">        &quot;experimentalDecorators&quot;: true,</div><div class="line">        &quot;emitDecoratorMetadata&quot;: true,</div><div class="line">        &quot;declaration&quot;: false,</div><div class="line">        &quot;noImplicitAny&quot;: false,</div><div class="line">        &quot;removeComments&quot;: true,</div><div class="line">        &quot;noLib&quot;: false,</div><div class="line">        &quot;preserveConstEnums&quot;: true,</div><div class="line">        &quot;suppressImplicitAnyIndexErrors&quot;: true</div><div class="line">    &#125;,</div><div class="line">    &quot;filesGlob&quot;: [</div><div class="line">        &quot;**/*.ts&quot;,</div><div class="line">        &quot;**/*.tsx&quot;,</div><div class="line">        &quot;!node_modules/**&quot;</div><div class="line">    ],</div><div class="line">    &quot;files&quot;: [</div><div class="line">        &quot;constants.ts&quot;,</div><div class="line">        &quot;interfaces.d.ts&quot;,</div><div class="line">        &quot;todoModel.ts&quot;,</div><div class="line">        &quot;utils.ts&quot;,</div><div class="line">        &quot;app.tsx&quot;,</div><div class="line">        &quot;footer.tsx&quot;,</div><div class="line">        &quot;todoItem.tsx&quot;</div><div class="line">    ],</div><div class="line">    &quot;exclude&quot;: []</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果我们认真阅读了<a href="https://github.com/Microsoft/TypeScript/wiki/Compiler-Options" target="_blank" rel="external">TypeScript compiler options</a>我们就能够知道该如何使用<code>tsconfig.json</code>文件：</p>
<blockquote>
<p>参数<code>--project</code>或者<code>-p</code> 都能用于编译项目在给定的文件下。这个文件需要含有<code>tsconfig.json</code>文件来直接编译。</p>
</blockquote>
<p>我们可以编译我们的应用程序通过以下命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//在应用程序的根目录</div><div class="line">$ tsc -p js</div></pre></td></tr></table></figure></p>
<p>执行这个命令之后，应该会在<code>js</code>文件夹下生成以下JavaScript文件：</p>
<p><img src="/uploads/2015/12/17/9/5.png" alt=""></p>
<p>这些文件会在我们的<code>index.html</code>文件中引用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;js/constants.js&quot;&gt;&lt;/script&gt;</div><div class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;js/utils.js&quot;&gt;&lt;/script&gt;</div><div class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;js/todoModel.js&quot;&gt;&lt;/script&gt;</div><div class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;js/todoItem.js&quot;&gt;&lt;/script&gt;</div><div class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;js/footer.js&quot;&gt;&lt;/script&gt;</div><div class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;js/app.js&quot;&gt;&lt;/script&gt;</div></pre></td></tr></table></figure>
<p>接下来我们准备运行我们的应用程序。</p>
<h2 id="运行应用程序"><a href="#运行应用程序" class="headerlink" title="运行应用程序"></a>运行应用程序</h2><p>为了运行我们的应用程序，我们需要一个web服务器。这里我们通过npm来安装<a href="https://www.npmjs.com/package/http-server" target="_blank" rel="external">http-server</a>。这里博主推荐使用<a href="anywhere">https://www.npmjs.com/package/anywhere</a>。</p>
<p>我们通过以下命令来安装http-server:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install -g http-server</div></pre></td></tr></table></figure>
<blockquote>
<p>如果你使用的是OSX系统，请使用sudo权限</p>
</blockquote>
<p>运用以下命令来运行应用程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 在应用的根目录</div><div class="line">$ http-server</div></pre></td></tr></table></figure>
<p>如果你打开浏览器导航到<code>http://127.0.0.1:8080/</code>,你应用可以看到应用程序正在运行：<br><img src="/uploads/2015/12/17/9/7yjwysnxnekg_retina.png" alt=""></p>
<p>记得打开谷歌浏览器开发者工具去查看一下React 开发者扩展工具 并且查看一下当你与应用程序交互时，如何改变组件的属性和状态的值。<br><img src="/uploads/2015/12/17/9/td99h20vs5yzq_retina.png" alt=""></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在这篇博客中我们已经学习了怎么搭建开发环境和怎么使用TypeScript来开发React应用程序。</p>
<p>你可以查看这个项目的<a href="https://github.com/tastejs/todomvc/tree/master/examples/typescript-react" target="_blank" rel="external">源码</a></p>
<p>如果你想了解更多内容？请查看<a href="http://jaysoo.ca/2015/09/26/typed-react-and-redux/" target="_blank" rel="external">Type React and Redux</a></p>
<p><img src="/uploads/mypictures/xsstomyzhifubao.png" alt=""></p>
</div><div class="tags"><a href="/tags/React/">React</a><a href="/tags/TypeScript/">TypeScript</a></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" id="search" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://xsstomy.com"/></form></div><div class="widget"><div class="widget-title"> 分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Egret/">Egret</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/只读经典/">只读经典</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/思维改变生活/">思维改变生活</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"> 标签</div><div class="tagcloud"><a href="/tags/设计模式之蝉/" style="font-size: 12px;">设计模式之蝉</a> <a href="/tags/Egret/" style="font-size: 18px;">Egret</a> <a href="/tags/EgretWing/" style="font-size: 16.5px;">EgretWing</a> <a href="/tags/Git/" style="font-size: 12px;">Git</a> <a href="/tags/Mac/" style="font-size: 12px;">Mac</a> <a href="/tags/快捷键/" style="font-size: 12px;">快捷键</a> <a href="/tags/React/" style="font-size: 16.5px;">React</a> <a href="/tags/TypeScript/" style="font-size: 12px;">TypeScript</a> <a href="/tags/2016/" style="font-size: 15px;">2016</a> <a href="/tags/ES2015/" style="font-size: 12px;">ES2015</a> <a href="/tags/Gulp/" style="font-size: 12px;">Gulp</a> <a href="/tags/内存泄漏/" style="font-size: 12px;">内存泄漏</a> <a href="/tags/Node-js/" style="font-size: 13.5px;">Node.js</a> <a href="/tags/跨屏互动/" style="font-size: 12px;">跨屏互动</a> <a href="/tags/赛车游戏/" style="font-size: 16.5px;">赛车游戏</a> <a href="/tags/工作流/" style="font-size: 12px;">工作流</a> <a href="/tags/总结/" style="font-size: 12px;">总结</a> <a href="/tags/Electron/" style="font-size: 12px;">Electron</a> <a href="/tags/微信/" style="font-size: 12px;">微信</a> <a href="/tags/调试/" style="font-size: 12px;">调试</a> <a href="/tags/Vim/" style="font-size: 12px;">Vim</a> <a href="/tags/读书感/" style="font-size: 12px;">读书感</a> <a href="/tags/工作/" style="font-size: 12px;">工作</a> <a href="/tags/市场需求/" style="font-size: 12px;">市场需求</a> <a href="/tags/产品/" style="font-size: 12px;">产品</a> <a href="/tags/本质/" style="font-size: 12px;">本质</a> <a href="/tags/思想/" style="font-size: 12px;">思想</a> <a href="/tags/Virtual-Dom/" style="font-size: 12px;">Virtual Dom</a> <a href="/tags/如何阅读一本书/" style="font-size: 12px;">如何阅读一本书</a></div></div><div class="widget"><div class="widget-title"> 最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/02/16/思维改变生活：快乐/">思维改变生活：快乐</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/09/如何读一本书/">如何读一本书</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/01/2170101LoveAllTrustAFewDoWrongToNone2016/">Love All,Trust A Few,Do Wrong To None 2016</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/08/20161208-seek-a-job/">找工作</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/24/20161024-reading-dark-time/">暗时间</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/13/20161013-react-virtual-dom/">如何编写你自己的virtual dom</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/03/20161003-vim/">vim 初入坑</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/28/2016:08:28-reactjs-summarize/">reactjs 学习到项目生产的总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/17/20160817summraze-six-months/">半年总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/13/20160813android-weixin-debug/">手机微信端调试</a></li></ul></div><div class="widget"><div class="widget-title"> 友情链接</div><ul class="links-list"><li class="links-list-item"><a href="http://featherj.org" title="FeatherJ" target="_blank">FeatherJ</a></li></ul><ul class="links-list"><li class="links-list-item"><a href="http://idom.me" title="Dom" target="_blank">Dom</a></li></ul><ul class="links-list"><li class="links-list-item"><a href="http://xzper.com" title="纸片儿" target="_blank">纸片儿</a></li></ul><ul class="links-list"><li class="links-list-item"><a href="http://yjtxlib.com" title="Yjtx" target="_blank">Yjtx</a></li></ul><ul class="links-list"><li class="links-list-item"><a href="http://chuangzaoshi.com" title="创造狮" target="_blank">创造狮</a></li></ul></div></div></div></div><div id="footer"></div><span id="busuanzi_container_site_pv"><span> </span><span rel="nofollow" id="busuanzi_value_site_pv"></span><span rel="nofollow">  浏览量, </span></span><span id="busuanzi_container_site_uv"><span rel="nofollow" id="busuanzi_value_site_uv"></span><span rel="nofollow">  人次</span></span>© <a href="/." rel="nofollow">卖苹果的.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a> Theme<a target="_blank" href="https://github.com/7ye/maupassant-hexo"> Maupassant.</a><a id="back_to_top" href="javascript:void(0)" class="back_to_top"><span>△</span></a><script type="text/javascript" src="/js/totop.js?v=0.0.0"></script><link rel="stylesheet" href="/css/jquery.fancybox.css"><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-91405857-1','auto');ga('send','pageview');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?927847cdebb6617d0945219f8ded1a83";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script>function auto_code_fit(){
  if($(".highlight").length != 0){
    var pc_width = $(".post-content").width();
    $(".highlight .code").find("pre").width((pc_width-70)+"px");
  }
}
window.onresize = function(){
  auto_code_fit();
}
auto_code_fit();</script></div></body>